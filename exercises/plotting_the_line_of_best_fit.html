<!DOCTYPE html>
<html data-require="math math-format graphie interactive">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Plotting the line of best fit</title>
    <script src="../khan-exercise.js"></script>
</head>
<body>
<div class="exercise">
    <div class="problems">
        <div>
            <div class="vars">
                <var id="SLOPE">randRange(-100, 100) / 20</var>
                <var id="INTERSECT">randRange(-5, 5)</var>
                <var id="FUNC">function(x) { return SLOPE * x + INTERSECT }</var>
                <var id="TOP">(10 - INTERSECT) / abs(SLOPE)</var>
                <var id="BOTTOM">(-10 - INTERSECT) / abs(SLOPE)</var>
                <var id="BOUND">function(x, low, high) { return (x < low) ? low : (x > high) ? high : x; }</var>
                <var id="OFFSET">randRange(2, 4) / 2</var>
                <var id="XS">(function() {

                    var right = (TOP > 10) ? 10 : TOP;
                    var left = (BOTTOM < -10) ? -10 : BOTTOM;

                    var range = (right - left) / 20;

                    return _.map(shuffle(_.range(-8, 9), 7), function(x) {
                        return round(x * range);
                    });
                })()</var>
                <var id="ANG">atan2(SLOPE, 1) + PI / 2</var>
                <var id="PERP">[cos(ANG), sin(ANG)]</var>
                <var id="TOTALOFFSET">[]</var>
                <var id="POINTS">_.map(XS, function(x) {
                    var total = _.reduce(TOTALOFFSET, function(sum, num) {
                        return sum + abs(num);
                    }, 0) / TOTALOFFSET.length;

                    if (isNaN(total)) {
                        total = OFFSET;
                    }

                    total = BOUND(total, OFFSET / 2, OFFSET * 2);

                    console.log(total);

                    scale = OFFSET / total;

                    var offset = randRange(-OFFSET, OFFSET) * scale;
                    TOTALOFFSET.push(offset);

                    return [BOUND(round(x + PERP[0] * offset), -9, 9),
                            BOUND(round(FUNC(x) + PERP[1] * offset), -9, 9)];
                })</var>
            </div>

            <p class="question">Find the line of best fit</p>
            <div class="problem">
                <div class="graphie">
                    graphInit({
                        range: 11,
                        scale: 20,
                        axisArrows: "&lt;-&gt;",
                        tickStep: 1,
                        labelStep: 1,
                        gridOpacity: 0.05,
                        axisOpacity: 0.2,
                        tickOpacity: 0.4,
                        labelOpacity: 0.5
                    });

                    var func = function(x) {
                        return SLOPE * x + INTERSECT;
                    };

                    _.each(POINTS, function(pt) {
                        circle(pt, 0.2, { fill: "black" });
                    });

                    addMouseLayer();
                    graph.pointA = addMovablePoint({
                        coord: [ -5, 5 ],
                        snapX: 0.5,
                        snapY: 0.5,
                        normalStyle: {
                            stroke: KhanUtil.BLUE,
                            fill: KhanUtil.BLUE
                        }
                    });
                    graph.pointB = addMovablePoint({
                        coord: [ 5, 5 ],
                        snapX: 0.5,
                        snapY: 0.5,
                        normalStyle: {
                            stroke: KhanUtil.BLUE,
                            fill: KhanUtil.BLUE
                        }
                    });
                    graph.line1 = addMovableLineSegment({
                        pointA: graph.pointA,
                        pointZ: graph.pointB,
                        fixed: true,
                        extendLine: true
                    });

                    // A and B can't be in the same place
                    graph.pointA.onMove = function( x, y ) {
                        return ( x != graph.pointB.coord[0] || y != graph.pointB.coord[1] );
                    }
                    graph.pointB.onMove = function( x, y ) {
                        return ( x != graph.pointA.coord[0] || y != graph.pointA.coord[1] );
                    }

                    graph.pointA.toFront();
                    graph.pointB.toFront();

                </div>
            </div>

            <div class="solution" data-type="custom">
                <div class="instruction">
                    Move the line to be a line of best fit for the data points.
                </div>
                <div class="guess">
                    [graph.pointA.coord, graph.pointB.coord]
                </div>
                <div class="validator-function">
                    var slope = (guess[0][1] - guess[1][1]) / (guess[0][0] - guess[1][0]);
                    var intersect = slope * -guess[0][0] + guess[0][1];
                    console.log(abs(slope / SLOPE - 1) + abs(intersect - INTERSECT) / SLOPE);
                    return abs(slope / SLOPE - 1) + abs(intersect - INTERSECT) / (abs(SLOPE) + 1)< OFFSET;
                </div>
                <div class="show-guess">
                    graph.pointA.coord = guess[0];
                    graph.pointB.coord = guess[1];

                    graph.line1.transform();
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
